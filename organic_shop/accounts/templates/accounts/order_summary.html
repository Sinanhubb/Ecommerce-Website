{% extends 'shop/base.html' %}
{% load static %}

{% block content %}
<div class="container py-5">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card shadow-sm">
                <div class="card-header bg-white border-bottom-0">
                    <div class="d-flex justify-content-between align-items-center">
                        <h2 class="h4 mb-0">Order Summary</h2>
                        <span class="badge bg-primary">Order #{{ order.id }}</span>
                    </div>
                    <hr class="mt-2 mb-0">
                </div>
                
                <div class="card-body">
                    <!-- Shipping Information -->
                    <div class="mb-4">
    <div class="d-flex align-items-center mb-3">
        <i class="fas fa-truck text-primary me-2"></i>
        <h4 class="mb-0">Shipping Details</h4>
    </div>
    <div class="card border p-3">
        <div class="row">
            <div class="col-md-6 mb-3 mb-md-0">
                <h6 class="fw-bold mb-2">Contact Information</h6>
                <p class="mb-1"><strong>Name:</strong> {{ order.address.full_name }}</p>
                <p class="mb-1"><strong>Phone:</strong> {{ order.address.phone }}</p>
                {% if order.address.email %}
                <p class="mb-0"><strong>Email:</strong> {{ order.address.email }}</p>
                {% endif %}
            </div>
            <div class="col-md-6">
                <h6 class="fw-bold mb-2">Shipping Address</h6>
                <p class="mb-1">{{ order.address.address_line }}</p>
                <p class="mb-1">{{ order.address.city }}, {{ order.address.country }}</p>
                <p class="mb-0">{{ order.address.postal_code }}</p>
                {% if order.address.landmark %}
                <p class="mb-0 mt-1"><small class="text-muted">Landmark: {{ order.address.landmark }}</small></p>





                <p><strong>Address:</strong> {{ order.address.full_name }}, {{ order.address.address_line }}, {{ order.address.city }}, {{ order.address.country }} - {{ order.address.postal_code }}</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

                    <!-- Order Details - Fixed Version -->
                    <div class="mb-4">
    <div class="d-flex align-items-center mb-3">
        <i class="fas fa-box-open text-primary me-2"></i>
        <h4 class="mb-0">Order Items</h4>
        <span class="badge bg-secondary ms-2">{{ order.orderitem_set.count }} items</span>
    </div>
    <div class="table-responsive">
        <table class="table table-bordered">
            <thead class="table-light">
                <tr>
                    <th style="width: 50%">Product</th>
                    <th class="text-end" style="width: 15%">Unit Price</th>
                    <th class="text-center" style="width: 15%">Qty</th>
                    <th class="text-end" style="width: 20%">Total</th>
                </tr>
            </thead>
            <tbody>
                {% for item in order.orderitem_set.all %}
                <tr>
                    <td>
                        <div class="d-flex align-items-center">
                            <img src="{% if item.product.image %}{{ item.product.image.url }}{% else %}{% static 'images/default-product.png' %}{% endif %}" 
                                 class="img-thumbnail me-3" width="60" alt="{{ item.product.name }}">
                            <div>
                                <h6 class="mb-1">{{ item.product.name }}</h6>
                                {% if item.product.sku %}
                                <small class="text-muted">SKU: {{ item.product.sku }}</small>
                                {% endif %}
                            </div>
                        </div>
                    </td>
                    <td class="text-end">₹{{ item.price|floatformat:2 }}</td>
                    <td class="text-center">{{ item.quantity }}</td>
                    <td class="text-end fw-bold">₹{{ item.get_total_price|floatformat:2 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

                    <!-- Payment Summary -->
                    <div class="mb-4">
    <div class="d-flex align-items-center mb-3">
        <i class="fas fa-credit-card text-primary me-2"></i>
        <h4 class="mb-0">Payment Summary</h4>
    </div>
    <div class="card border p-3">
        <ul class="list-group list-group-flush">
            <li class="list-group-item d-flex justify-content-between bg-transparent px-0">
                <span>Subtotal ({{ order.get_item_count }} item{{ order.get_item_count|pluralize }}):</span>
                <span>₹{{ order.get_subtotal|floatformat:2 }}</span>
            </li>
            <li class="list-group-item d-flex justify-content-between bg-transparent px-0">
                <span>Shipping Fee:</span>
                <span>Free</span>
            </li>
            {% if order.promo_code %}
            <li class="list-group-item d-flex justify-content-between bg-transparent px-0">
                <span>Discount ({{ order.promo_code.code }}):</span>
                <span class="text-danger">-₹{{ order.get_discount_amount|floatformat:2 }}</span>
            </li>
            {% endif %}
            <li class="list-group-item d-flex justify-content-between bg-transparent px-0 pt-3 border-top-2">
                <strong>Total Amount:</strong>
                <strong>₹{{ order.total_price|floatformat:2 }}</strong>
            </li>
            <li class="list-group-item bg-transparent px-0 pt-3 border-0">
                <div class="d-flex justify-content-between mb-1">
                    <span class="fw-bold">Payment Method:</span>
                    <span class="badge bg-{% if order.payment_method == 'cod' %}warning{% else %}success{% endif %} text-dark">
                        {{ order.get_payment_method_display }}
                    </span>
                </div>
                {% if order.payment_method == "cod" %}
                <p class="small text-muted mb-0">Pay ₹{{ order.total_price|floatformat:2 }} when your order arrives</p>
                {% endif %}
            </li>
        </ul>
    </div>
</div>

                    <!-- Confirmation -->
                    <div class="text-center mt-4">
                        <form method="post" action="{% url 'accounts:place_order' order.id %}">
                            {% csrf_token %}
                            <div class="form-check d-flex justify-content-center mb-3">
                                <input class="form-check-input me-2" type="checkbox" id="terms" required>
                                <label class="form-check-label" for="terms">
                                    I agree to the <a href="#" data-bs-toggle="modal" data-bs-target="#termsModal">Terms & Conditions</a>
                                </label>
                            </div>
                            <button type="submit" class="btn btn-primary btn-lg px-5">
                                <i class="fas fa-check-circle me-2"></i> Confirm & Place Order
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="termsModal" tabindex="-1" aria-labelledby="termsModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="termsModalLabel">Terms & Conditions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>Your order is subject to our terms and conditions. Please review the following:</p>
                <ul>
                    <li>All orders are subject to product availability</li>
                    <li>Prices are subject to change without notice</li>
                    <li>Delivery times are estimates only</li>
                    <li>Returns must be made within 30 days of purchase</li>
                </ul>
                <p>By placing this order, you agree to these terms.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}




